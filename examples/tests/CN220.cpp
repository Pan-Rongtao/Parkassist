#include "catch2/catch.hpp"
#include "Window.h"
#include "Common.h"
#include "parkassist/gles/fwd.h"

using namespace nb;

#define PROJECT_NAME	"CN220"
#define WIDTH 1280
#define HEIGHT 800

std::vector<std::vector<std::vector<double>>> pointsCN220 =
{
	{
		{ 380.029968,534.298462, 390.323547,520.131470, 400.167328,506.875763, 409.552673,494.489136, 418.479401,482.924896, 426.953613,472.133972, 434.986694,462.066345, 442.593475,452.672424, 449.791473,443.904083, 456.599670,435.715179, 463.038116,428.061890, 469.127014,420.903137, 474.886536,414.200684, 480.336334,407.918976, 485.495514,402.025238, 490.382172,396.489288, 495.013672,391.283508, 499.406311,386.382477, 503.575470,381.762939, 507.535461,377.403748, 511.299805,373.285431, 514.880920,369.390289, 518.290588,365.702057, 521.539551,362.205933, 524.637878,358.888367, 527.594971,355.736877, 530.419495,352.740112, 533.119446,349.887634, 535.702393,347.169830, 538.175293,344.577911 },
		{ 930.622131,534.770264, 920.294495,521.121643, 910.357666,508.298767, 900.826599,496.268433, 891.708374,484.992828, 883.003418,474.431549, 874.707031,464.542786, 866.810303,455.284393, 859.301453,446.614960, 852.166321,438.494354, 845.389343,430.883942, 838.954163,423.747131, 832.843811,417.049530, 827.041504,410.758820, 821.530334,404.845001, 816.294067,399.280151, 811.317017,394.038574, 806.583923,389.096466, 802.080444,384.431824, 797.792969,380.024597, 793.708618,375.856201, 789.815125,371.909607, 786.101196,368.169189, 782.556091,364.620605, 779.169861,361.250641, 775.933044,358.047119, 772.836975,354.998962, 769.873474,352.095886, 767.034851,349.328430, 764.314087,346.687866 },
		{ 190, 211, 225, 125, 0.33, 190, 211, 225, 0, 0.57 },
		{380.029968,534.298462, 394.147705,534.310547, 408.265472,534.322632, 422.383209,534.334778, 436.500946,534.346863, 450.618713,534.358948, 464.736450,534.371033, 478.854187,534.383118, 492.971954,534.395264, 507.089691,534.407349, 521.207458,534.419434, 535.325195,534.431519, 549.442932,534.443604, 563.560669,534.455750, 577.678467,534.467834, 591.796143,534.479919, 605.913940,534.492004, 620.031677,534.504089, 634.149414,534.516235, 648.267212,534.528320, 662.384888,534.540405, 676.502686,534.552490, 690.620422,534.564636, 704.738159,534.576721, 718.855896,534.588806, 732.973633,534.600891, 747.091431,534.612976, 761.209106,534.625122, 775.326904,534.637207, 789.444641,534.649292, 803.562378,534.661377, 817.680176,534.673462, 831.797852,534.685608, 845.915649,534.697693, 860.033386,534.709778, 874.151123,534.721863, 888.268860,534.733948, 902.386597,534.746094, 916.504395,534.758179, 930.622131,534.770264},
		{ 379.968994,534.383362, 390.360352,536.677002, 401.223907,538.969666, 412.573608,541.251587, 424.421204,543.511841, 436.775574,545.738098, 449.642029,547.916748, 463.021545,550.032959, 476.909882,552.070862, 491.297028,554.013611, 506.166412,555.843750, 521.494324,557.543518, 537.249451,559.095520, 553.392944,560.482788, 569.878540,561.689453, 586.652893,562.701538, 603.656250,563.506836, 620.823975,564.095947, 638.087524,564.462219, 655.376038,564.602051, 672.618103,564.515259, 689.743469,564.204773, 706.684753,563.676697, 723.378540,562.940063, 739.767273,562.006287, 755.799744,560.889160, 771.432190,559.603821, 786.628174,558.166809, 801.359070,556.595154, 815.603516,554.906067, 829.347290,553.116577, 842.582214,551.242981, 855.305969,549.300903, 867.520935,547.304810, 879.233582,545.268005, 890.453613,543.202515, 901.193481,541.119202, 911.467651,539.027588, 921.291870,536.936035, 930.683167,534.851868 },
		{ 190, 211, 225, 125, 0.33, 190, 211, 225, 125, 0.33 },
		{380.029968,534.298462, 390.323547,520.131470, 400.167328,506.875763, 409.552673,494.489136, 418.479401,482.924896, 426.953613,472.133972, 434.986694,462.066345, 442.593475,452.672424, 449.791473,443.904083, 456.599670,435.715179, 463.038116,428.061890, 469.127014,420.903137, 474.886536,414.200684, 480.336334,407.918976, 485.495514,402.025238, 490.382172,396.489288, 495.013672,391.283508, 499.406311,386.382477, 503.575470,381.762939, 507.535461,377.403748, 511.299805,373.285431, 514.880920,369.390289, 518.290588,365.702057, 521.539551,362.205933, 524.637878,358.888367, 527.594971,355.736877, 530.419495,352.740112, 533.119446,349.887634, 535.702393,347.169830, 538.175293,344.577911},
		{ 387.509430,535.957886, 397.694489,521.533386, 407.420349,508.053955, 416.679749,495.474152, 425.473938,483.743958, 433.810577,472.811035, 441.702423,462.622314, 449.165741,453.125488, 456.219147,444.269836, 462.882751,436.006989, 469.177429,428.291229, 475.124176,421.079712, 480.743744,414.332733, 486.056305,408.013550, 491.081268,402.088257, 495.837067,396.525818, 500.341217,391.297760, 504.610168,386.378113, 508.659332,381.743042, 512.503113,377.370850, 516.154968,373.241791, 519.627319,369.337769, 522.931824,365.642242, 526.079163,362.140167, 529.079407,358.817780, 531.941711,355.662476, 534.674744,352.662689, 537.286377,349.807892, 539.783997,347.088409, 542.174500,344.495270 },
		{ 255, 255, 0, 255, 0.33, 255, 255, 0, 20, 0.57 },
		{405.471100,539.734985, 415.338318,524.713135, 424.728333,510.717377, 433.637390,497.694031, 442.070251,485.584656, 450.038116,474.328949, 457.557037,463.866333, 464.646240,454.137634, 471.326965,445.086151, 477.621521,436.658142, 483.552582,428.803223, 489.142670,421.474640, 494.413605,414.629242, 499.386414,408.227356, 504.081116,402.232697, 508.516541,396.612091, 512.710449,391.335358, 516.679321,386.375000, 520.438599,381.705963, 524.002563,377.305573, 527.384399,373.153107, 530.596497,369.229767, 533.650085,365.518402, 536.555664,362.003418, 539.322876,358.670624, 541.960693,355.506989, 544.477356,352.500702, 546.880493,349.640930, 549.177124,346.917725, 551.373840,344.321991},
		{ 410.978241,540.835022, 420.732208,525.636230, 430.004852,511.488251, 438.793457,498.334778, 447.103912,486.114685, 454.948486,474.765076, 462.344116,464.223145, 469.310852,454.427612, 475.870697,445.319855, 482.046539,436.844543, 487.861481,428.949921, 493.338379,421.588043, 498.499298,414.714722, 503.365479,408.289429, 507.957031,402.275146, 512.292847,396.638153, 516.390625,391.347717, 520.266907,386.375946, 523.937012,381.697388, 527.415100,377.289093, 530.714417,373.130066, 533.847107,369.201324, 536.824341,365.485535, 539.656433,361.966949, 542.353027,358.631226, 544.922974,355.465302, 547.374268,352.457184, 549.714478,349.596008, 551.950623,346.871765, 554.088989,344.275299 },
		{ 255, 255, 0, 255, 0.32, 255, 255, 0, 20, 0.57 },
		{448.583313,547.635803, 457.376007,531.313477, 465.678314,516.206604, 473.494751,502.239655, 480.838013,489.332672, 487.726501,477.405121, 494.182465,466.378204, 500.230316,456.176422, 505.895325,446.728821, 511.202972,437.969452, 516.178040,429.837463, 520.844543,422.277313, 525.225037,415.238434, 529.340759,408.674896, 533.211609,402.545227, 536.856018,396.811951, 540.290771,391.441223, 543.531677,386.402588, 546.592957,381.668457, 549.487854,377.214050, 552.228455,373.016876, 554.825806,369.056702, 557.290039,365.315125, 559.630493,361.775543, 561.855591,358.422852, 563.973267,355.243347, 565.990601,352.224579, 567.914246,349.355164, 569.750305,346.624756, 571.504272,344.023865},
		{ 454.957825,548.668030, 463.556702,532.170654, 471.667175,516.915710, 479.294830,502.824097, 486.453400,489.812653, 493.162079,477.797882, 499.443756,466.698242, 505.323303,456.435944, 510.826324,446.937988, 515.978394,438.136749, 520.804443,429.969971, 525.328247,422.380859, 529.572449,415.317871, 533.558105,408.734283, 537.304810,402.587921, 540.830688,396.840729, 544.152527,391.458466, 547.285583,386.410187, 550.244141,381.668091, 553.040955,377.207031, 555.687927,373.004395, 558.195923,369.039703, 560.574768,365.294403, 562.833557,361.751801, 564.980652,358.396667, 567.023621,355.215179, 568.969482,352.194855, 570.824646,349.324249, 572.595032,346.592926, 574.286011,343.991364 },
		{ 255, 255, 0, 255, 0.31, 255, 255, 0, 20, 0.57 },
		{862.664673,548.009399, 853.473206,532.117981, 844.739197,517.356995, 836.466492,503.662384, 828.649902,490.965363, 821.278015,479.195648, 814.334351,468.283508, 807.799438,458.161407, 801.651855,448.765167, 795.869385,440.034515, 790.429565,431.913269, 785.310181,424.349762, 780.489929,417.296570, 775.948364,410.710327, 771.666077,404.551575, 767.624878,398.784546, 763.807922,393.376678, 760.199280,388.298523, 756.784424,383.523376, 753.549744,379.027039, 750.482788,374.787628, 747.572021,370.785217, 744.806763,367.001740, 742.177185,363.420868, 739.674377,360.027618, 737.289917,356.808441, 735.016174,353.750946, 732.846069,350.843872, 730.773010,348.076843, 728.791077,345.440460},
		{ 868.478271,547.038940, 859.146240,531.321228, 850.269653,516.708313, 841.853394,503.139160, 833.893433,490.547791, 826.379089,478.866730, 819.294861,468.028687, 812.621887,457.968353, 806.339355,448.623413, 800.425476,439.935303, 794.858093,431.849304, 789.615295,424.314880, 784.675842,417.285645, 780.019348,410.719147, 775.626404,404.576569, 771.478882,398.822723, 767.559692,393.425598, 763.853027,388.356140, 760.343994,383.587952, 757.018982,379.097168, 753.865417,374.862091, 750.871460,370.863007, 748.026428,367.082062, 745.320435,363.502991, 742.744141,360.110992, 740.289185,356.892578, 737.947693,353.835480, 735.712524,350.928406, 733.577026,348.161163, 731.534973,345.524323 },
		{ 255, 255, 0, 255, 0.32, 255, 255, 0, 20, 0.57 },
		{902.631714,540.732666, 892.634094,526.106262, 883.065552,512.431702, 873.936890,499.664185, 865.250122,487.753937, 857.000793,476.648865, 849.178833,466.296082, 841.770630,456.643219, 834.759644,447.639465, 828.127747,439.236328, 821.855774,431.387848, 815.924255,424.050903, 810.313599,417.185547, 805.004822,410.754578, 799.979309,404.723846, 795.219421,399.061951, 790.708374,393.740082, 786.430176,388.731903, 782.369873,384.013245, 778.513489,379.562164, 774.847961,375.358521, 771.360962,371.384003, 768.041138,367.621796, 764.877991,364.056580, 761.861633,360.674408, 758.982971,357.462372, 756.233521,354.408813, 753.605408,351.502930, 751.091370,348.734894, 748.684631,346.095612},
		{ 907.617798,539.723877, 897.546814,525.266357, 887.899048,511.738281, 878.686096,499.096863, 869.911072,487.294647, 861.570251,476.281677, 853.654541,466.007080, 846.151001,456.420349, 839.044128,447.472412, 832.316284,439.116180, 825.948975,431.307068, 819.923096,424.003082, 814.219543,417.165192, 808.819641,410.757141, 803.704956,404.745422, 798.858154,399.099243, 794.262451,393.790314, 789.901978,388.792725, 785.761902,384.082703, 781.828186,379.638580, 778.087769,375.440521, 774.528320,371.470398, 771.138550,367.711578, 767.907715,364.148926, 764.825989,360.768585, 761.884155,357.557831, 759.073730,354.505035, 756.386719,351.599518, 753.815796,348.831482, 751.354065,346.191925 },
		{ 255, 255, 0, 255, 0.33, 255, 255, 0, 20, 0.57 },
		{923.862793,536.277283, 913.596436,522.386169, 903.731262,509.351135, 894.281372,497.136322, 885.252686,485.701172, 876.644470,475.002594, 868.450684,464.996094, 860.661255,455.637207, 853.263184,446.882263, 846.241333,438.689087, 839.579224,431.017273, 833.259521,423.828644, 827.264648,417.087433, 821.577148,410.760162, 816.179749,404.815735, 811.055603,399.225403, 806.188782,393.962646, 801.563843,389.003052, 797.166138,384.324066, 792.981934,379.905121, 788.998230,375.727295, 785.202759,371.773193, 781.584106,368.026855, 778.131653,364.473724, 774.835266,361.100372, 771.685730,357.894470, 768.674255,354.844727, 765.792725,351.940765, 763.033691,349.173035, 760.389954,346.532715},
		{ 930.622131,534.770264, 920.294495,521.121643, 910.357666,508.298767, 900.826599,496.268433, 891.708374,484.992828, 883.003418,474.431549, 874.707031,464.542786, 866.810303,455.284393, 859.301453,446.614960, 852.166321,438.494354, 845.389343,430.883942, 838.954163,423.747131, 832.843811,417.049530, 827.041504,410.758820, 821.530334,404.845001, 816.294067,399.280151, 811.317017,394.038574, 806.583923,389.096466, 802.080444,384.431824, 797.792969,380.024597, 793.708618,375.856201, 789.815125,371.909607, 786.101196,368.169189, 782.556091,364.620605, 779.169861,361.250641, 775.933044,358.047119, 772.836975,354.998962, 769.873474,352.095886, 767.034851,349.328430, 764.314087,346.687866 },
		{ 255, 255, 0, 255, 0.33, 255, 255, 0, 20, 0.57 },
		{379.968994,534.383362, 390.360352,536.677002, 401.223907,538.969666, 412.573608,541.251587, 424.421204,543.511841, 436.775574,545.738098, 449.642029,547.916748, 463.021545,550.032959, 476.909882,552.070862, 491.297028,554.013611, 506.166412,555.843750, 521.494324,557.543518, 537.249451,559.095520, 553.392944,560.482788, 569.878540,561.689453, 586.652893,562.701538, 603.656250,563.506836, 620.823975,564.095947, 638.087524,564.462219, 655.376038,564.602051, 672.618103,564.515259, 689.743469,564.204773, 706.684753,563.676697, 723.378540,562.940063, 739.767273,562.006287, 755.799744,560.889160, 771.432190,559.603821, 786.628174,558.166809, 801.359070,556.595154, 815.603516,554.906067, 829.347290,553.116577, 842.582214,551.242981, 855.305969,549.300903, 867.520935,547.304810, 879.233582,545.268005, 890.453613,543.202515, 901.193481,541.119202, 911.467651,539.027588, 921.291870,536.936035, 930.683167,534.851868},
		{ 377.517792,537.805542, 387.942993,540.189148, 398.848938,542.573364, 410.250488,544.948120, 422.160217,547.302002, 434.587860,549.622131, 447.539520,551.894287, 461.016907,554.102844, 475.016388,556.231018, 489.528351,558.261047, 504.536407,560.174438, 520.016724,561.952332, 535.937622,563.576050, 552.259521,565.027588, 568.934937,566.289917, 585.908936,567.348022, 603.120056,568.188965, 620.501282,568.802429, 637.981689,569.181396, 655.488037,569.322021, 672.946228,569.224121, 690.283508,568.890930, 707.430115,568.328979, 724.320679,567.548096, 740.895813,566.560547, 757.102905,565.381104, 772.897156,564.026184, 788.241516,562.513306, 803.107056,560.860657, 817.472473,559.086609, 831.323730,557.209106, 844.653259,555.245483, 857.459167,553.212219, 869.744690,551.124390, 881.517151,548.996094, 892.787048,546.839783, 903.567627,544.666809, 913.874268,542.487000, 923.723511,540.309082, 933.133057,538.140564 },
		{ 255, 0, 0, 255, 0.33, 255, 0, 0, 255, 0.33 },
		{410.978241,540.835022, 420.732208,525.636230, 430.004852,511.488251, 438.793457,498.334778, 447.103912,486.114685, 454.948486,474.765076, 462.344116,464.223145, 469.310852,454.427612, 475.870697,445.319855, 482.046539,436.844543, 487.861481,428.949921, 493.338379,421.588043, 498.499298,414.714722, 503.365479,408.289429, 507.957031,402.275146, 512.292847,396.638153, 516.390625,391.347717, 520.266907,386.375946, 523.937012,381.697388, 527.415100,377.289093, 530.714417,373.130066, 533.847107,369.201324, 536.824341,365.485535, 539.656433,361.966949, 542.353027,358.631226, 544.922974,355.465302, 547.374268,352.457184, 549.714478,349.596008, 551.950623,346.871765, 554.088989,344.275299},
		{ 448.583313,547.635803, 457.376007,531.313477, 465.678314,516.206604, 473.494751,502.239655, 480.838013,489.332672, 487.726501,477.405121, 494.182465,466.378204, 500.230316,456.176422, 505.895325,446.728821, 511.202972,437.969452, 516.178040,429.837463, 520.844543,422.277313, 525.225037,415.238434, 529.340759,408.674896, 533.211609,402.545227, 536.856018,396.811951, 540.290771,391.441223, 543.531677,386.402588, 546.592957,381.668457, 549.487854,377.214050, 552.228455,373.016876, 554.825806,369.056702, 557.290039,365.315125, 559.630493,361.775543, 561.855591,358.422852, 563.973267,355.243347, 565.990601,352.224579, 567.914246,349.355164, 569.750305,346.624756, 571.504272,344.023865 },
		{ 189, 193, 0, 255, 0.32, 189, 193, 0, 20, 0.57 },
		{868.478271,547.038940, 859.146240,531.321228, 850.269653,516.708313, 841.853394,503.139160, 833.893433,490.547791, 826.379089,478.866730, 819.294861,468.028687, 812.621887,457.968353, 806.339355,448.623413, 800.425476,439.935303, 794.858093,431.849304, 789.615295,424.314880, 784.675842,417.285645, 780.019348,410.719147, 775.626404,404.576569, 771.478882,398.822723, 767.559692,393.425598, 763.853027,388.356140, 760.343994,383.587952, 757.018982,379.097168, 753.865417,374.862091, 750.871460,370.863007, 748.026428,367.082062, 745.320435,363.502991, 742.744141,360.110992, 740.289185,356.892578, 737.947693,353.835480, 735.712524,350.928406, 733.577026,348.161163, 731.534973,345.524323},
		{ 902.631714,540.732666, 892.634094,526.106262, 883.065552,512.431702, 873.936890,499.664185, 865.250122,487.753937, 857.000793,476.648865, 849.178833,466.296082, 841.770630,456.643219, 834.759644,447.639465, 828.127747,439.236328, 821.855774,431.387848, 815.924255,424.050903, 810.313599,417.185547, 805.004822,410.754578, 799.979309,404.723846, 795.219421,399.061951, 790.708374,393.740082, 786.430176,388.731903, 782.369873,384.013245, 778.513489,379.562164, 774.847961,375.358521, 771.360962,371.384003, 768.041138,367.621796, 764.877991,364.056580, 761.861633,360.674408, 758.982971,357.462372, 756.233521,354.408813, 753.605408,351.502930, 751.091370,348.734894, 748.684631,346.095612 },
		{ 189, 193, 0, 255, 0.32, 189, 193, 0, 20, 0.57 },
	},
};

TEST_CASE(PROJECT_NAME, std::string("[") + PROJECT_NAME + "]")
{
	Window w(WIDTH, HEIGHT, PROJECT_NAME);
	std::shared_ptr<Scene> sc = std::make_shared<Scene>(WIDTH, HEIGHT);
	
	w.ResizeEvent += [&w, &sc](const Window::Size &sz)
	{
		sc->doRender();
		w.swapBuffers();
	};

	static int state = -1;
	auto polygonBG = Common::getBackground(std::string("../etc/") + PROJECT_NAME + ".bmp", WIDTH, HEIGHT);
	sc->add(polygonBG);

	w.KeyEvent += [&w, &sc, polygonBG](const int &key)
	{
		switch (key)
		{
		case GLFW_KEY_LEFT:
		{
			if (state - 1 < 0)	return;

			--state;
			auto polygons = Common::getPolygons(pointsCN220[state]);
			sc->clear();
			sc->add(polygonBG);
			for (auto const p : polygons)
			{
				sc->add(p);
			}
		}
		break;
		case GLFW_KEY_RIGHT:
		{
			if (state + 1 >= (int)pointsCN220.size())	return;

			++state;
			auto polygons = Common::getPolygons(pointsCN220[state]);
			sc->clear();
			sc->add(polygonBG);
			for (auto const p : polygons)
			{
				sc->add(p);
			}
		}
		break;
		case GLFW_KEY_SPACE:
		{
			sc->enableBorder(!sc->isBorderEnable());
		}
		break;
		default:	break;
		}
		sc->doRender();
		w.swapBuffers();
	};

	sc->doRender();
	w.swapBuffers();

	while (true)
	{
		Window::pollEvents();
	}
}